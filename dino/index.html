<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Animal Safari</title>
    <!-- Friendly Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-top: #E0F7FA;
            --bg-bottom: #81ecec;
            --card-bg: #ffffff;
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --text-main: #2D3436;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bottom) 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ✨ PARTICLES CANVAS */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        /* 🏠 HOME BUTTON */
        .home-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            text-decoration: none;
            box-shadow: 0 4px 0 #cbd5e1;
            border: 2px solid #e2e8f0;
            z-index: 100;
            transition: transform 0.1s;
        }
        .home-btn:active { transform: translateY(4px); box-shadow: none; }

        /* --- LAYOUT --- */
        .app-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-top: 80px; /* Space for home button/header */
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Fredoka One', cursive;
            color: var(--primary);
            font-size: 2.8rem;
            margin: 0 0 20px 0;
            text-shadow: 3px 3px 0px rgba(255,255,255,0.8);
            text-align: center;
            letter-spacing: 1px;
            animation: floatHeader 3s ease-in-out infinite;
        }

        @keyframes floatHeader {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* --- ANIMAL GRID --- */
        .safari-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 16px;
            width: 100%;
            padding: 10px;
            padding-bottom: 40px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Hide scrollbar */
        .safari-grid::-webkit-scrollbar { display: none; }

        .animal-card {
            background: #fff;
            border-radius: 24px;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 4px solid #fff;
            box-shadow: 0 8px 15px rgba(0,0,0,0.05), 0 4px 0 #e2e8f0;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            opacity: 0; /* For entrance animation */
            animation: popIn 0.5s forwards;
        }

        /* Staggered animation delay logic is handled in JS */

        .animal-card:active {
            transform: scale(0.92) translateY(4px) !important;
            box-shadow: 0 2px 0 #e2e8f0 !important;
        }

        .animal-emoji {
            font-size: 3.5rem;
            line-height: 1.2;
            filter: drop-shadow(0 4px 0 rgba(0,0,0,0.1));
            transition: transform 0.2s;
        }
        
        .animal-name {
            font-family: 'Fredoka One', cursive;
            color: #636e72;
            font-size: 1.1rem;
            margin-top: 8px;
            text-align: center;
        }

        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.5) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* --- STAGE OVERLAY (Pop-up) --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .stage-content {
            text-align: center;
            transform: scale(0.8) translateY(20px);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            background: white;
            padding: 40px;
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            border: 6px solid #f1f2f6;
            max-width: 90%;
        }

        .overlay.active .stage-content {
            transform: scale(1) translateY(0);
        }

        #stage-emoji {
            font-size: 8rem;
            display: block;
            margin-bottom: 10px;
            animation: floatEmoji 3s ease-in-out infinite;
        }

        @keyframes floatEmoji {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        #stage-text {
            font-family: 'Fredoka One', cursive;
            font-size: 3.5rem;
            color: var(--text-main);
            margin: 0;
            display: block;
        }

        #stage-subtext {
            font-family: 'Nunito', sans-serif;
            font-size: 1.5rem;
            color: var(--secondary);
            font-weight: 800;
            margin-top: 10px;
            opacity: 0.8;
        }

        .close-hint {
            position: absolute;
            bottom: 40px;
            font-size: 1.1rem;
            color: #b2bec3;
            font-weight: 700;
            animation: pulse 2s infinite;
            background: rgba(255,255,255,0.5);
            padding: 10px 20px;
            border-radius: 20px;
        }

        @keyframes pulse {
            0% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.6; transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .safari-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .animal-card { border-radius: 20px; }
            .animal-emoji { font-size: 3rem; }
            h1 { font-size: 2.2rem; }
            
            .stage-content { padding: 30px 20px; width: 85%; }
            #stage-emoji { font-size: 7rem; }
            #stage-text { font-size: 2.8rem; }
            #stage-subtext { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <canvas id="particles"></canvas>
    
    <a href="/" class="home-btn" title="Back to Games">🏠</a>

    <div class="app-container">
        <h1>Animal Safari 🌍</h1>
        <div class="safari-grid" id="grid">
            <!-- Animals injected here -->
        </div>
    </div>

    <!-- Full Screen Overlay -->
    <div class="overlay" id="overlay">
        <div class="stage-content">
            <div id="stage-emoji">🦁</div>
            <div id="stage-text">Lion</div>
            <div id="stage-subtext">"Roar!"</div>
        </div>
        <div class="close-hint">Tap anywhere to close</div>
    </div>

    <script>
        /**
         * Animal Safari
         * Focus: Big touch targets, Realistic Audio, Juice
         */

        // High-Quality MP3s (Google Search Sounds) for broad mobile compatibility
        const ANIMALS = [
            { 
                name: 'Lion', emoji: '🦁', color: '#FAB1A0', bg: '#fff0e6',
                sound: 'The Lion says, Roar!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/lion.mp3' 
            },
            { 
                name: 'Dog', emoji: '🐶', color: '#74b9ff', bg: '#e8f4ff',
                sound: 'The Dog says, Woof Woof!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/dog.mp3' 
            },
            { 
                name: 'Cat', emoji: '🐱', color: '#fd79a8', bg: '#fff0f6',
                sound: 'The Cat says, Meow!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/cat.mp3' 
            },
            { 
                name: 'Cow', emoji: '🐮', color: '#00b894', bg: '#e6fffa',
                sound: 'The Cow says, Moooooo!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/cow.mp3' 
            },
            { 
                name: 'Pig', emoji: '🐷', color: '#ff7675', bg: '#fff0ef',
                sound: 'The Pig says, Oink Oink!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/pig.mp3' 
            },
            { 
                name: 'Monkey', emoji: '🐵', color: '#fdcb6e', bg: '#fff9db',
                sound: 'The Monkey says, Ooh Ooh Ah Ah!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/ape.mp3' 
            },
            { 
                name: 'Elephant', emoji: '🐘', color: '#a29bfe', bg: '#f3f0ff',
                sound: 'The Elephant goes, Trumpet!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/elephant.mp3' 
            },
            { 
                name: 'Duck', emoji: '🦆', color: '#00cec9', bg: '#e6fffe',
                sound: 'The Duck says, Quack Quack!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/duck.mp3' 
            },
            { 
                name: 'Sheep', emoji: '🐑', color: '#636e72', bg: '#f1f2f6',
                sound: 'The Sheep says, Baaaaa!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/sheep.mp3' 
            },
            { 
                name: 'Tiger', emoji: '🐯', color: '#e17055', bg: '#fff0eb',
                sound: 'The Tiger says, Grrrrr!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/tiger.mp3' 
            },
            { 
                name: 'Frog', emoji: '🐸', color: '#27ae60', bg: '#ebfbee',
                sound: 'The Frog says, Ribbit!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/frog.mp3' 
            },
            { 
                name: 'Horse', emoji: '🐎', color: '#d35400', bg: '#fff0e6',
                sound: 'The Horse says, Neigh!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/horse.mp3' 
            },
            { 
                name: 'Rooster', emoji: '🐔', color: '#d63031', bg: '#ffeaea',
                sound: 'The Rooster says, Cock-a-doodle-doo!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/rooster.mp3' 
            },
            { 
                name: 'Owl', emoji: '🦉', color: '#8e44ad', bg: '#f3e5f5',
                sound: 'The Owl says, Hoot Hoot!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/owl.mp3' 
            },
            { 
                name: 'Zebra', emoji: '🦓', color: '#2d3436', bg: '#f5f6fa',
                sound: 'The Zebra says, Whinny!', 
                audioUrl: 'https://www.google.com/logos/fnbx/animal_sounds/zebra.mp3' 
            },
            { 
                name: 'Bee', emoji: '🐝', color: '#f1c40f', bg: '#fff9db',
                sound: 'The Bee says, Buzz Buzz!', 
                audioUrl: 'https://actions.google.com/sounds/v1/animals/bee_buzz.ogg' 
            },
            // Fallbacks for those without direct Google MP3s
            { name: 'Bear', emoji: '🐻', color: '#7f8c8d', sound: 'The Bear says, Grrrr!', bg: '#f8f9fa' },
            { name: 'Giraffe', emoji: '🦒', color: '#e67e22', sound: 'The Giraffe says, Munch Munch!', bg: '#fff3e0' },
            { name: 'Snake', emoji: '🐍', color: '#2ecc71', sound: 'The Snake says, Hiss!', bg: '#ebfbee' },
            { name: 'Mouse', emoji: '🐭', color: '#a29bfe', sound: 'The Mouse says, Squeak Squeak!', bg: '#f3f0ff' },
        ];

        // State
        let state = {
            voice: null,
            isLocked: false,
            currentAudio: null // Track currently playing audio to stop it
        };

        // Elements
        const grid = document.getElementById('grid');
        const overlay = document.getElementById('overlay');
        const stageEmoji = document.getElementById('stage-emoji');
        const stageText = document.getElementById('stage-text');
        const stageSub = document.getElementById('stage-subtext');
        const canvas = document.getElementById('particles');

        // --- Init ---
        function init() {
            setupVoice();
            renderGrid();
            setupCanvas();
            
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = setupVoice;
            }

            overlay.addEventListener('click', closeOverlay);
        }

        function setupVoice() {
            const voices = window.speechSynthesis.getVoices();
            state.voice = voices.find(v => v.name.includes('Google US English')) ||
                          voices.find(v => v.name.includes('Samantha')) ||
                          voices.find(v => v.lang === 'en-US') ||
                          voices[0];
        }

        function renderGrid() {
            grid.innerHTML = '';
            ANIMALS.forEach((animal, index) => {
                const card = document.createElement('div');
                card.className = 'animal-card';
                card.style.borderColor = animal.bg; 
                card.style.animationDelay = `${index * 0.05}s`; 
                
                card.style.background = `linear-gradient(135deg, #ffffff 40%, ${animal.bg} 100%)`;

                const emoji = document.createElement('div');
                emoji.className = 'animal-emoji';
                emoji.textContent = animal.emoji;

                const name = document.createElement('div');
                name.className = 'animal-name';
                name.textContent = animal.name;
                name.style.color = '#2d3436'; 

                card.appendChild(emoji);
                card.appendChild(name);

                const interact = (e) => {
                    e.preventDefault();
                    activateAnimal(animal);
                };

                card.addEventListener('click', interact);
                card.addEventListener('touchstart', interact, {passive: false});

                grid.appendChild(card);
            });
        }

        function activateAnimal(animal) {
            if (state.isLocked) return;
            state.isLocked = true;

            // Stop any previous sound immediately
            stopAudio();

            // 1. Pop Visuals
            stageEmoji.textContent = animal.emoji;
            stageText.textContent = animal.name;
            stageText.style.color = animal.color;
            stageSub.textContent = "🔊 Listening...";
            
            overlay.classList.add('active');

            // 2. Particles
            createExplosion(window.innerWidth/2, window.innerHeight/2, animal.color);

            // 3. Audio Logic (Realistic > TTS)
            setTimeout(() => {
                playAnimalSound(animal);
            }, 300);
        }

        function playAnimalSound(animal) {
            // Try playing audio file if it exists
            if (animal.audioUrl) {
                const audio = new Audio(animal.audioUrl);
                state.currentAudio = audio;
                
                // Fallback to TTS if audio fails (network error, bad link)
                audio.onerror = (e) => {
                    console.log("Audio failed to load, falling back to TTS", e);
                    speak(animal.sound);
                };

                // Play
                audio.play().catch(e => {
                    console.log("Autoplay prevented or error", e);
                    speak(animal.sound);
                });
            } else {
                // No audio URL, direct TTS
                speak(animal.sound);
            }
        }

        function stopAudio() {
            // Stop TTS
            window.speechSynthesis.cancel();
            
            // Stop Real Audio
            if (state.currentAudio) {
                state.currentAudio.pause();
                state.currentAudio.currentTime = 0;
                state.currentAudio = null;
            }
        }

        function closeOverlay() {
            overlay.classList.remove('active');
            stopAudio();
            setTimeout(() => {
                state.isLocked = false;
            }, 300);
        }

        function speak(text) {
            // Double check cancellation
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            if (state.voice) utterance.voice = state.voice;
            utterance.rate = 0.9;
            utterance.pitch = 1.1; 
            window.speechSynthesis.speak(utterance);
        }

        // --- PARTICLE SYSTEM ---
        const ctx = canvas.getContext('2d');
        let particles = [];

        function setupCanvas() {
            const resize = () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            };
            window.addEventListener('resize', resize);
            resize();
            animateParticles();
        }

        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y;
                this.color = color;
                this.size = Math.random() * 12 + 6; 
                this.speedX = Math.random() * 10 - 5;
                this.speedY = Math.random() * 10 - 5;
                this.life = 100;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.speedY += 0.3; // Gravity
                this.life -= 1.5;
                this.size *= 0.94;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function createExplosion(x, y, color) {
            for (let i = 0; i < 45; i++) {
                particles.push(new Particle(x, y, color));
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(animateParticles);
        }

        init();

    </script>
</body>
</html>